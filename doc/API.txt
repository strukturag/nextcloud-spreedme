
                    Spreed.ME Nextcloud API v1.0.0
            ===============================================
                        (c)2016 struktur AG

The Spreed.ME Nextcloud app provides an (currently not RESTful) API endpoint.
REST is not fulfilled, as Nextcloud core currently doesn't support it.
This API currently is marked "private" in the sense that we can change it at
any point of time and it's solely your responsibility to watch for changes.

The REST API should always return valid JSON data. This includes the non 200
status responses. If non-JSON is received it is an error not generated by the
API or there was a problem while JSON encoding.

Some endpoints of this API require a valid Nextcloud session. To get this session
it is sufficient to POST user credentials to the Nextcloud login endpoint.
The server (Nextcloud) then sets a cookie which can be used for authentication.
This session-cookie should always be sent if available. Alternatively, you
can include the user credentials in a Authorization header for every request.


Available endpoints with request methods and content-type:

  /api/v1/config

    The config endpoint returns the location where spreed-webrtc can be found.
    This endpoint does not require authentication. It's public.

    GET application/x-www-form-urlencoded
      No parameters.
      Response 200:
        {
          "success": true,
          "spreed_webrtc": {
            "url": "https://pferdeapfel.intranet.struktur.de:9999/webrtc/"
          }
        }


  /api/v1/user/config

    The user/config endpoint returns information about the currently
    authenticated user. This endpoint requires authentication.

    GET application/x-www-form-urlencoded
      No parameters.
      Response 200:
        {
          "success": true,
          "id": "admin",
          "display_name": "Administrator",
          "is_admin": true,
          "is_spreedme_admin": true
        }


  /api/v1/user/token

    The user/token endpoint returns the token required to authenticate
    to spreed-webrtc. This endpoint requires authentication.

    GET application/x-www-form-urlencoded
      No parameters.
      Response 200:
        {
          "success": true,
          "useridcombo": "1449147545:admin",
          "secret": "Cd2ma2yhMD/cZCH4M2bURGjhQV0+SEP43PJMmIkv4+w="
        }


  /api/v1/token/withtp

    The token/withtp endpoint returns a token which can be used by non-Nextcloud users
    to authenticate to spreed-webrtc. It requires a temporary password.
    This endpoint does not require authentication. It's public.

    POST application/x-www-form-urlencoded
      tp: The temporary password
      Response 200:
        {
          "success": true,
          "useridcombo": "1450885700:test",
          "secret": "0QaHuJ3WuSf6ONErhZvJO8H9Lxu0uaEbGSnmxQh/T1A="
        }


  /api/v1/admin/tp

    The admin/tp endpoint returns a temporary password.
    This endpoint requires admin authentication.

    POST application/x-www-form-urlencoded
      userid: The user id to invite
      expiration: UNIX timestamp representation of expiration date
      Response 200:
        {
          "success": true,
          "tp": "MTQ3MTk0ODUwMDpleHQvdGVzdC81N2JjMGFjMTgzNWQ2NS4xNzIwNTQ2NjoyOmlxYUphS2duYVRVdUhySHZjR1lkY0xmaVNxMk5ZMGR6OVZVSU5oOU1sMzg9"
        }


  /api/v1/file/download

    The file/download endpoint provides download functionality of Nextcloud documents.
    It redirects to a URL where the file ultimately can be found.
    This endpoint and the URL it redirects to both require a valid session (cookie).

    GET application/x-www-form-urlencoded
      file: The full path to the file to download (string)
      Response 200: Redirect to the requested file which can then be downloaded.


  /api/v1/admin/config

    The admin/config endpoint allows admins to update the app configuration.
    Please also see config/config.php.in.
    This endpoint requires admin authentication + a valid Nextcloud CSRF requesttoken.

    PATCH application/x-www-form-urlencoded
      SPREED_WEBRTC_ORIGIN: Domain of the Spreed WebRTC server (including protocol and optional port number) (string, optional)
      SPREED_WEBRTC_BASEPATH: Spreed WebRTC basepath (string, optional)
      OWNCLOUD_TEMPORARY_PASSWORD_LOGIN_ENABLED: Whether the 'Temporary Password' feature should be enabled (string, optional)
      SPREED_WEBRTC_IS_SHARED_INSTANCE: Whether the Spreed WebRTC server is used by multiple Nextcloud instances (string, optional)
      SPREED_WEBRTC_UPLOAD_FILE_TRANSFERS: Whether to upload file transfers or share them peer-to-peer (string, optional)
      SPREED_WEBRTC_ALLOW_ANONYMOUS_FILE_TRANSFERS: Whether anonymous users (i.e. users which are not logged in) should be able to upload/share files and presentations (string, optional). This value is only taken into account when 'SPREED_WEBRTC_UPLOAD_FILE_TRANSFERS' is set to true
      Response 200:
        {
          "success": true
        }


  /api/v1/admin/config/regenerate/sharedsecret

    The admin/config/regenerate/sharedsecret endpoint generates, stores, and returns a new SPREED_WEBRTC_SHAREDSECRET.
    This shared secret has to be used in the Spreed WebRTC config (sharedsecret_secret).
    This endpoint requires admin authentication + a valid Nextcloud CSRF requesttoken.

    POST application/x-www-form-urlencoded
      Response 200:
        {
          "success": true,
          "sharedsecret": "8485adfe6d78521fc4710f14172e4566328b558bda9f3bd3d017a45135e37cfc"
        }


  /api/v1/admin/config/regenerate/tp-key

    The admin/config/regenerate/tp-key endpoint generates and stores a new OWNCLOUD_TEMPORARY_PASSWORD_SIGNING_KEY.
    This endpoint requires admin authentication + a valid Nextcloud CSRF requesttoken.

    POST application/x-www-form-urlencoded
      Response 200:
        {
          "success": true
        }


End of API.

For questions, contact mailto:info@struktur.de.


(c)2016 struktur AG
